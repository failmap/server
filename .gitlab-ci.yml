stages:
  - check
  - test

check:
  stage: check
  before_script:
    # install check requirements
    - apt-get update -yqq
    - apt-get install -yqq make puppet-lint shellcheck
  script:
    - make check

# Debian Jessie is currently leading OS
provision:debian: &provision_template
  stage: test
  tags: ['vagrant']
  before_script:
    - apt-get update -q
    - apt-get install vagrant virtualbox

  script:
    # provision an instance using vagrant/virtualbox
    # this will run a testsuite at the end to validate
    - vagrant up

  # make used OS explicit (currently this defaults in Vagrantfile)
  variables:
    VAGRANT_BOX: debian/jessie64

# Ubuntu Xenial is first candidate to also be supported
provision:ubuntu:
  <<: *provision_template

  variables:
    VAGRANT_BOX: ubuntu/xenial64

  # until all issues are addressed don't fail on this build
  allow_failure: true


